 <!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#111111">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Painel de Produ√ß√£o">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" href="icon-192.png">
<title>Painel de Produ√ß√£o</title>

<style>
body {
  margin:0;
  font-family:Arial, sans-serif;
  background:#1b1b1b;
  color:white;
  height:100vh;
  display:flex;
  flex-direction:column;
}

header {
  background:#111;
  padding:10px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  position:relative;
}

/* =========================
   LOGIN
========================= */
#loginOverlay {
  position: fixed;
  inset: 0;
  background: #111;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.login-box {
  background: #222;
  padding: 25px;
  border-radius: 16px;
  width: 300px;
  text-align: center;
}

.login-box h2 {
  margin-bottom: 15px;
}

.usuarios {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.usuarios button {
  flex: 1;
  height: 45px;
  border-radius: 10px;
  border: none;
  font-weight: bold;
  cursor: pointer;
  background: #444;
  color: #fff;
  opacity: .6;
}

.usuarios button.ativo {
  opacity: 1;
  outline: 2px solid #ffca28;
}

.login-box input {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: none;
  margin: 0 auto 12px auto;
  font-size: 16px;
  text-align: center;
  display: block;
  box-sizing: border-box;
}

#loginErro {
  color: #ff5252;
  margin-top: 10px;
}

#fecharCozinha {
  position:absolute;
  right:10px;
  top:10px;
  border:1px solid #555;
  background:transparent;
  color:#bbb;
  padding:6px 12px;
  border-radius:10px;
  cursor:pointer;
}

#logoutBtn {
  position: absolute;
  left: 10px;
  top: 10px;
  border: 1px solid #555;
  background: transparent;
  color: #bbb;
  padding: 6px 12px;
  border-radius: 10px;
  cursor: pointer;
}

#logoutBtn:hover {
  background: #333;
}

.pin {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 15px;
}

.pin span {
  width: 14px;
  height: 14px;
  background: #555;
  border-radius: 50%;
}

.pin span.filled {
  background: #fff;
}

.keypad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 10px;
}

.keypad button {
  height: 48px;
  font-size: 18px;
  border-radius: 10px;
  border: none;
  background: #333;
  color: white;
  font-weight: bold;
}

.keypad .clear {
  background: #c62828;
}

.keypad .ok {
  background: #2e7d32;
}

.modos {
  display:flex;
  gap:6px;
  padding:6px;
  background:#222;
}

.modos button {
  flex:1;
  height:40px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  opacity:.5;
}

.modos .ativo { opacity:1; }

.fila { background:#555; }
.encomenda { background:#ffca28; color:#000; }
.senha { background:#ab47bc; }

.contadores {
  display:flex;
  justify-content:space-around;
  background:#222;
  padding:6px;
  font-size:14px;
}

.botoes {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
  padding:8px;
}

button {
  height:50px;
  font-size:14px;
  font-weight:bold;
  border-radius:12px;
  border:none;
  color:white;
}

.carne { background:#e53935; }
.peixe { background:#1e88e5; }
.veg { background:#43a047; }
.opcao { background:#000; }

.take {
  border:2px dashed rgba(255,255,255,.6);
}

.painel {
  flex:1;
  display:flex;
  gap:6px;
  padding:6px;
}

.coluna {
  flex:1;
  background:#2a2a2a;
  border-radius:10px;
  padding:6px;
}

.coluna h2 {
  text-align:center;
  font-size:16px;
  margin:4px 0;
}

.pedido {
  height:38px;
  margin-bottom:4px;
  border-radius:8px;
  font-size:13px;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  background:var(--base-color);
}

/* Faixas ENCOMENDA e SENHA */
.pedido.encomenda {
  background:
    linear-gradient(to right, #ffca28 0%, #ffca28 33%, transparent 33%),
    var(--base-color);
}

.pedido.senha {
  background:
    linear-gradient(to right, #ab47bc 0%, #ab47bc 33%, transparent 33%),
    var(--base-color);
}

/* üõë Corre√ß√£o de contraste: OP√á√ïES + ENCOMENDA */
.pedido.encomenda.opcao {
  color: #fff;
}

.excluir {
  position:absolute;
  right:6px;
  top:6px;
  font-size:16px;
  cursor:pointer;
}

#resumo {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  align-items:center;
  justify-content:center;
}

#resumo .box {
  background:#222;
  padding:25px;
  border-radius:15px;
  width:320px;
  text-align:center;
}

/* =========================
   BOT√ïES DO RESUMO
========================= */

#resumo .box button {
  width: 100%;
  margin-top: 12px;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-size: 15px;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.1s ease;
}

/* Bot√£o PDF */
#resumo .btn-pdf {
  background: #1e88e5;
  color: #fff;
}

#resumo .btn-pdf:hover {
  background: #1565c0;
}

/* Bot√£o Encerrar */
#resumo .btn-encerrar {
  background: #e53935;
  color: #fff;
}

#resumo .btn-encerrar:hover {
  background: #c62828;
}

/* Clique */
#resumo .box button:active {
  transform: scale(0.97);
}

/* =========================
   AVATARES LOGIN
========================= */
.usuarios.avatars {
  display: flex;
  justify-content: space-between;
  gap: 14px;
  margin-bottom: 20px;
}

.avatar {
  flex: 1;
  background: #333;
  border-radius: 14px;
  padding: 12px 8px;
  text-align: center;
  cursor: pointer;
  opacity: 0.5;
  transition: all 0.2s ease;
}

.avatar img {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  margin-bottom: 6px;
}

.avatar span {
  display: block;
  font-size: 13px;
  font-weight: bold;
}

.avatar.ativo {
  opacity: 1;
  outline: 2px solid #ffca28;
}

</style>
</head>

<body>
<!-- üîê LOGIN OVERLAY -->
<div id="loginOverlay">
  <div class="login-box">
    <h2>üîê Acesso ao Sistema</h2>

    <div class="usuarios avatars">
      <div class="avatar" onclick="selecionarUsuario('balcao', this)">
        <img src="avatars/balcao.png" alt="Balc√£o">
        <span>Balc√£o</span>
      </div>

      <div class="avatar" onclick="selecionarUsuario('cozinha', this)">
        <img src="avatars/cozinha.png" alt="Cozinha">
        <span>Cozinha</span>
      </div>

      <div class="avatar" onclick="selecionarUsuario('admin', this)">
        <img src="avatars/admin.png" alt="Admin">
        <span>Admin</span>
      </div>
    </div>

    <div class="pin">
      <span></span><span></span><span></span><span></span>
    </div>

    <div class="keypad">
      <button>1</button><button>2</button><button>3</button>
      <button>4</button><button>5</button><button>6</button>
      <button>7</button><button>8</button><button>9</button>
      <button class="clear">C</button>
      <button>0</button>
      <button class="ok">‚úî</button>
    </div>

    <p id="loginErro"></p>
  </div>
</div>

<header>
üçΩÔ∏è PAINEL DE PRODU√á√ÉO
<button id="logoutBtn" onclick="logout()">üö™ Sair</button>
<button id="fecharCozinha" onclick="confirmarFecho()">Fechar Cozinha</button>
</header>

<div class="modos">
<button class="fila ativo" onclick="setModo('fila',this)">üßç FILA</button>
<button class="encomenda" onclick="setModo('encomenda',this)">üì¶ ENCOMENDA</button>
<button class="senha" onclick="setModo('senha',this)">üé´ SENHA</button>
</div>

<div class="contadores">
üî¥ <span id="cCarne">0</span>
üü¶ <span id="cPeixe">0</span>
üü© <span id="cVeg">0</span>
‚ö´ <span id="cOpcao">0</span>
</div>

<div class="botoes">
<button class="carne" onclick="novoPedido('carne', false)">CARNE</button>
<button class="carne take" onclick="novoPedido('carne', true)">CARNE + TAKE</button>

<button class="peixe" onclick="novoPedido('peixe', false)">PEIXE</button>
<button class="peixe take" onclick="novoPedido('peixe', true)">PEIXE + TAKE</button>

<button class="veg" onclick="novoPedido('veg', false)">VEG</button>
<button class="veg take" onclick="novoPedido('veg', true)">VEG + TAKE</button>

<button class="opcao" onclick="novoPedido('opcao', false)">OP√á√ïES</button>
<button class="opcao take" onclick="novoPedido('opcao', true)">OP√á√ïES + TAKE</button>
</div>

<div class="painel">
  <div class="coluna" id="preparo"><h2>üë®‚Äçüç≥ EM PREPARO</h2></div>
  <div class="coluna" id="pronto"><h2>‚úÖ PRONTO</h2></div>
</div>

<div id="resumo">
  <div class="box">
    <h2>üìä Resumo do Turno</h2>
    <p>üî¥ Carne: <strong id="rCarne"></strong><br>
    <small>Take: <strong id="rCarneTake"></strong></small></p>

    <p>üü¶ Peixe: <strong id="rPeixe"></strong><br>
    <small>Take: <strong id="rPeixeTake"></strong></small></p>

    <p>üü© Veg: <strong id="rVeg"></strong><br>
    <small>Take: <strong id="rVegTake"></strong></small></p>

    <p>‚ö´ Op√ß√µes: <strong id="rOpcao"></strong><br>
    <small>Take: <strong id="rOpcaoTake"></strong></small></p>
    <p><strong>TOTAL: <span id="rTotal"></span></strong></p>
    <button class="btn-pdf" onclick="gerarPDFResumo()">üìÑ Baixar PDF</button>
    <button class="btn-encerrar" onclick="location.reload()">‚èπ Encerrar e reiniciar</button>
  </div>
</div>

<script>
/* ==========================
   CONFIGURA√á√ïES GERAIS
========================== */
const RESTAURANTE = 'Cafetaria Blend - Vila Real';
const VERSAO_APP = '1.0.1';
const LOCALE = 'en-US' // ou 'pt-BR'

// üîê SENHA DE FECHO
const SENHA_FECHO = '0001'; // Defina aqui a senha do fecho

/* =========================
   LOGIN / PERMISS√ïES
========================= */
const SENHAS = {
  balcao: '1111',
  cozinha: '2222',
  admin: '9999'
};

let usuarioSelecionado = null;

function getRole() {
  return localStorage.getItem('usuario_role');
}

function isAdmin() {
  return getRole() === 'admin';
}

function podeCriarPedido() {
  const role = getRole();
  return role === 'balcao' || role === 'admin';
}

function podeMoverPedido() {
  const role = getRole();
  return role === 'cozinha' || role === 'admin';
}

function podeFinalizarPedido() {
  const role = getRole();
  return role === 'balcao' || role === 'admin';
}

function podeExcluirPedido() {
  const role = getRole();
  return role === 'balcao' || role === 'admin';
}

function podeFecharCozinha() {
  const role = getRole();
  return role === 'cozinha' || role === 'admin';
}

function selecionarUsuario(role, el) {
  usuarioSelecionado = role;

  document.querySelectorAll('.avatar')
    .forEach(a => a.classList.remove('ativo'));

  el.classList.add('ativo');
}

let pin = [];

document.querySelectorAll('.keypad button').forEach(btn => {
  btn.onclick = () => {
    const v = btn.textContent;

    if (v === 'C') {
      pin = [];
    } else if (v === '‚úî') {
      fazerLogin();
      return;
    } else if (pin.length < 4) {
      pin.push(v);
    }

    atualizarPin();
  };
});

function atualizarPin() {
  document.querySelectorAll('.pin span').forEach((dot, i) => {
    dot.classList.toggle('filled', !!pin[i]);
  });
}

function fazerLogin() {
  const erro = document.getElementById('loginErro');
  const senha = pin.join('');

  if (!usuarioSelecionado) {
    erro.innerText = 'Selecione um usu√°rio';
    return;
  }

  if (senha.length !== 4) {
    erro.innerText = 'Digite os 4 n√∫meros';
    return;
  }

  if (senha !== SENHAS[usuarioSelecionado]) {
    erro.innerText = 'Senha incorreta';
    pin = [];
    atualizarPin();
    return;
  }

  // ‚úÖ LOGIN OK
  localStorage.setItem('usuario_role', usuarioSelecionado);
  document.getElementById('loginOverlay').style.display = 'none';

  pin = [];
  atualizarPin();
  erro.innerText = '';

  aplicarPermissoes();
}

function aplicarPermissoes() {
  const role = localStorage.getItem('usuario_role');

  const btnFechar = document.getElementById('fecharCozinha');
  if (btnFechar) {
    btnFechar.style.display =
      (role === 'cozinha' || role === 'admin') ? 'block' : 'none';
  }

  const btnLogout = document.getElementById('logoutBtn');
  if (btnLogout) {
    btnLogout.style.display = role ? 'block' : 'none';
  }
}

function logout() {
  if (!confirm('Deseja sair do sistema?')) return;

  localStorage.removeItem('usuario_role');

  // Limpa estado
  usuarioSelecionado = null;
  pin = [];
  atualizarPin();

  document.getElementById('loginErro').innerText = '';

  document.querySelectorAll('.usuarios button')
    .forEach(b => b.classList.remove('ativo'));

  // Mostra login novamente
  document.getElementById('loginOverlay').style.display = 'flex';

  aplicarPermissoes();
}

// üîÅ Auto login
document.addEventListener('DOMContentLoaded', () => {
  const role = localStorage.getItem('usuario_role');
  if (role) {
    document.getElementById('loginOverlay').style.display = 'none';
    aplicarPermissoes();
  }
});

/* ==========================
   ESTADO GLOBAL
========================== */
let modo='fila';
let numero=0;
const cont = {
  carne: 0,
  peixe: 0,
  veg: 0,
  opcao: 0,

  take: {
    carne: 0,
    peixe: 0,
    veg: 0,
    opcao: 0
  },

  origem: {
    fila: {
      carne: 0,
      peixe: 0,
      veg: 0,
      opcao: 0
    },
    encomenda: {
      carne: 0,
      peixe: 0,
      veg: 0,
      opcao: 0
    },
    senha: {
      carne: 0,
      peixe: 0,
      veg: 0,
      opcao: 0
    }
  }
};
let ultimoResumoTurno = null;


function setModo(m,b){
  modo=m;
  document.querySelectorAll('.modos button').forEach(x=>x.classList.remove('ativo'));
  b.classList.add('ativo');
}

function atualizar(){
  cCarne.innerText=cont.carne;
  cPeixe.innerText=cont.peixe;
  cVeg.innerText=cont.veg;
  cOpcao.innerText=cont.opcao;
}

function novoPedido(tipo, take) {
  if (!podeCriarPedido()) {
    alert('üö´ Voc√™ n√£o tem permiss√£o para criar pedidos.');
    return;
  }

  if (window.firebaseDB && window.firebaseDB.criarPedido) {
    window.firebaseDB.criarPedido(tipo, take);
  }
}

function renderPedido(id, pedido) {
  const { tipo, take, status } = pedido;

  // üö´ N√£o renderiza pedidos finalizados
  if (status === 'finalizado') return;

  const cores = {
    carne: '#e53935',
    peixe: '#1e88e5',
    veg: '#43a047',
    opcao: '#000'
  };

  const nomes = {
    carne: 'CARNE',
    peixe: 'PEIXE',
    veg: 'VEG',
    opcao: 'OP√á√ïES'
  };

  const p = document.createElement('div');
  p.className = `pedido ${pedido.modo} ${tipo}` + (take ? ' take' : '');
  p.style.setProperty('--base-color', cores[tipo]);
  p.dataset.id = id;
  p.innerText = nomes[tipo] + (take ? ' + TAKE' : '');

  if (podeExcluirPedido()) {
  const del = document.createElement('span');
  del.className = 'excluir';
  del.innerText = '‚ùå';

  function excluirPedido(e) {
    e.preventDefault();
    e.stopPropagation();

    const pedidoRef = window.firebaseDB.ref(
      window.firebaseDB.db,
      'pedidos/' + id
    );

    window.firebaseDB.remove(pedidoRef);
  }

  del.onclick = excluirPedido;
  del.addEventListener('touchend', excluirPedido, { passive: false });

  p.appendChild(del);
}
  
  // üîÅ Fluxo: preparo ‚Üí pronto ‚Üí finalizado
  function avancarStatus(e) {
  e.preventDefault();
  e.stopPropagation();

  const role = getRole();

  let novoStatus = null;

  // Preparo ‚Üí Pronto (cozinha + admin)
  if (pedido.status === 'preparo') {
    if (!podeMoverPedido()) return;
    novoStatus = 'pronto';
  }

  // Pronto ‚Üí Finalizado (balcao e admin)
  else if (pedido.status === 'pronto') {
    if (!podeFinalizarPedido()) return;

    // ‚úÖ CONTABILIZA ORIGEM NO FECHO REAL
    cont[pedido.tipo]++;

    if (pedido.take) {
      cont.take[pedido.tipo]++;
    }

    if (pedido.modo && cont.origem[pedido.modo]) {
      cont.origem[pedido.modo][pedido.tipo]++;
    }

    novoStatus = 'finalizado';
  }
    
  if (!novoStatus) return;

  const pedidoRef = window.firebaseDB.ref(
    window.firebaseDB.db,
    'pedidos/' + id
  );

  window.firebaseDB.set(pedidoRef, {
    ...pedido,
    status: novoStatus
  });
}

// Desktop / Android
p.onclick = avancarStatus;

// iOS (fundamental)
p.addEventListener('touchend', avancarStatus, { passive: false });

  if (status === 'preparo') {
    preparo.appendChild(p);
  } else if (status === 'pronto') {
    pronto.appendChild(p);
  }
}
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>  
async function fecharCozinha() {
  // 1Ô∏è‚É£ Montar resumo
  ultimoResumoTurno = {
    carne: cont.carne,
    peixe: cont.peixe,
    veg: cont.veg,
    opcao: cont.opcao,

    take: {
      carne: cont.take.carne,
      peixe: cont.take.peixe,
      veg: cont.take.veg,
      opcao: cont.take.opcao
    },

    origem: JSON.parse(JSON.stringify(cont.origem)),

    total: cont.carne + cont.peixe + cont.veg + cont.opcao,
    encerradoEm: Date.now(),
    encerradoEmTexto: new Date().toLocaleString(LOCALE)
  };

  // 2Ô∏è‚É£ Mostrar resumo na tela
  rCarne.innerText = ultimoResumoTurno.carne;
  rPeixe.innerText = ultimoResumoTurno.peixe;
  rVeg.innerText = ultimoResumoTurno.veg;
  rOpcao.innerText = ultimoResumoTurno.opcao;

  rCarneTake.innerText = ultimoResumoTurno.take.carne;
  rPeixeTake.innerText = ultimoResumoTurno.take.peixe;
  rVegTake.innerText = ultimoResumoTurno.take.veg;
  rOpcaoTake.innerText = ultimoResumoTurno.take.opcao;

  rTotal.innerText = ultimoResumoTurno.total;
  resumo.style.display = 'flex';

  // 3Ô∏è‚É£ Salvar relat√≥rio no Firebase (hist√≥rico)
  const relatorioRef = window.firebaseDB.ref(
    window.firebaseDB.db,
    'relatorios'
  );

  await window.firebaseDB.push(relatorioRef, ultimoResumoTurno);

  // 4Ô∏è‚É£ Limpar pedidos ativos
  const pedidosRef = window.firebaseDB.ref(
    window.firebaseDB.db,
    'pedidos'
  );

  await window.firebaseDB.remove(pedidosRef);
}

function confirmarFecho() {
  const senha = prompt('üîê Digite a senha para fechar a cozinha:');

  if (senha === null) return; // cancelado

  if (senha !== SENHA_FECHO) {
    alert('‚ùå Senha incorreta!');
    return;
  }

  // ‚úÖ Senha correta
  fecharCozinha();
}

function gerarPDFResumo() {
  if (!ultimoResumoTurno) {
    alert('Resumo ainda n√£o dispon√≠vel.');
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  // Configura√ß√µes de dimens√£o
  const pageWidth = 210;
  const marginX = 10;
  // Largura total dispon√≠vel
  const totalContentWidth = pageWidth - (marginX * 2); 
  
  let currentY = 0;

  // Cores (RGB)
  const colors = {
    bgHeader: [40, 40, 45],     // Cinza escuro do topo
    bgFooter: [230, 81, 0],     // Laranja do rodap√©
    bgCard: [255, 255, 255],    // Fundo branco
    bgRowGray: [240, 240, 240], // Fundo cinza da linha de detalhes
    textDark: [50, 50, 50],
    textLight: [255, 255, 255],
    types: {
      carne: [211, 47, 47],     // Vermelho
      peixe: [25, 118, 210],    // Azul
      veg: [56, 142, 60],       // Verde
      opcao: [40, 40, 45]      // Cinza Azulado Escuro
    }
  };

  /* =========================
     1. CABE√áALHO (HEADER)
  ========================= */
  doc.setFillColor(...colors.bgHeader);
  doc.rect(0, 0, pageWidth, 45, 'F');

  doc.setTextColor(255, 255, 255);
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(22);
  doc.text(RESTAURANTE, pageWidth / 2, 18, { align: 'center' });

  doc.setFontSize(16);
  doc.setFont('helvetica', 'normal');
  doc.text("Resumo do Turno", pageWidth / 2, 28, { align: 'center' });

  doc.setFontSize(10);
  doc.setTextColor(200, 200, 200);
  doc.text(`Encerrado em: ${ultimoResumoTurno.encerradoEmTexto}`, pageWidth / 2, 38, { align: 'center' });

  currentY = 55; 

  /* =========================
     2. FUN√á√ÉO DESENHAR CARD
  ========================= */
  function drawCard(label, typeKey, colorRGB) {
    const cardHeight = 35; 
    const headerHeight = 12; 
    const rowHeight = 11.5; 
    
    // Configura√ß√µes da Barra Vertical
    const barWidth = 5;  // Largura da barra colorida
    const gap = 3;       // Espa√ßo entre a barra e o cart√£o
    
    // O cart√£o come√ßa DEPOIS da barra e do gap
    const cardStartX = marginX + barWidth + gap;
    const cardWidth = totalContentWidth - barWidth - gap;

    // Dados
    const total = ultimoResumoTurno[typeKey];
    const take = ultimoResumoTurno.take[typeKey];
    const fila = ultimoResumoTurno.origem.fila[typeKey];
    const enc = ultimoResumoTurno.origem.encomenda[typeKey];
    const senha = ultimoResumoTurno.origem.senha[typeKey];

    // --- 1. BARRA VERTICAL LATERAL ---
    doc.setFillColor(...colorRGB);
    doc.rect(marginX, currentY, barWidth, cardHeight, 'F');

    // --- 2. FUNDO DO CART√ÉO (Sombra leve + Branco) ---
    // Sombra
    doc.setFillColor(230, 230, 230);
    doc.rect(cardStartX + 1, currentY + 1, cardWidth, cardHeight, 'F');
    // Branco
    doc.setFillColor(255, 255, 255);
    doc.rect(cardStartX, currentY, cardWidth, cardHeight, 'F');

    // --- 3. CABE√áALHO INCLINADO (Dentro do cart√£o) ---
    doc.setFillColor(...colorRGB);
    
    // Largura da faixa colorida no topo
    const ribbonWidth = 70; 
    
    // Pol√≠gono inclinado come√ßando em cardStartX
    doc.lines([
      [ribbonWidth, 0],         
      [-10, headerHeight],      
      [-(ribbonWidth - 10), 0], 
      [0, -headerHeight]        
    ], cardStartX, currentY, [1, 1], 'F', true);

    // Texto do T√≠tulo
    doc.setTextColor(255, 255, 255);
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(14);
    doc.text(`${label.toUpperCase()}: ${total}`, cardStartX + 5, currentY + 8);

    // Totalza√ß√£o no canto direito
    doc.setTextColor(40, 40, 40);
    doc.setFontSize(16);
    doc.text(total.toString(), cardStartX + cardWidth - 5, currentY + 8, { align: 'right' });

    // --- 4. Linha Take ---
    const row1Y = currentY + headerHeight;
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(12);
    doc.setTextColor(50, 50, 50);
    doc.text(`Take: ${take}`, cardStartX + 5, row1Y + 8);

    // --- 5. Linha Detalhes (Fundo Cinza) ---
    const row2Y = row1Y + rowHeight;
    
    doc.setFillColor(...colors.bgRowGray);
    doc.rect(cardStartX, row2Y, cardWidth, rowHeight, 'F');

    doc.setFontSize(11);
    doc.setTextColor(80, 80, 80);
    const detailText = `Fila: ${fila}    |    Encomenda: ${enc}    |    Senha: ${senha}`;
    doc.text(detailText, cardStartX + 5, row2Y + 8);

    // Avan√ßa Y
    currentY += cardHeight + 8; 
  }

  /* =========================
     3. GERA√á√ÉO DOS CARDS
  ========================= */
  drawCard('Carne', 'carne', colors.types.carne);
  drawCard('Peixe', 'peixe', colors.types.peixe);
  drawCard('Veg', 'veg', colors.types.veg);
  drawCard('Op√ß√µes', 'opcao', colors.types.opcao);

  /* =========================
     4. RODAP√â (TOTAL)
  ========================= */
  const footerY = currentY + 5; 

  doc.setFillColor(...colors.bgFooter);
  doc.rect(0, footerY, pageWidth, 15, 'F');

  doc.setTextColor(255, 255, 255);
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(16);
  
  doc.text('TOTAL:', marginX + 5, footerY + 10);
  doc.text(ultimoResumoTurno.total.toString(), pageWidth - marginX - 5, footerY + 10, { align: 'right' });

  doc.save(`Resumo_Turno_${new Date().toISOString().slice(0,10)}.pdf`);
}


</script>

<script type="module">
  // Firebase core
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";

  // Realtime Database
  import {
    getDatabase,
    ref,
    set,
    push,
    onValue,
    remove
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCms7tcWbslK-d0WZ6g8lFr_eicNaz4Dp4",
    authDomain: "painel-producao-sync.firebaseapp.com",
    databaseURL: "https://painel-producao-sync-default-rtdb.firebaseio.com",
    projectId: "painel-producao-sync",
    storageBucket: "painel-producao-sync.firebasestorage.app",
    messagingSenderId: "563084163424",
    appId: "1:563084163424:web:274866215bb7b2faf7c605"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // passo 1 - referencia principal dos pedidos
  const pedidosRef = ref(db, 'pedidos');

  //passo 2 - funcao para criar pedido
  function criarPedido(tipo, take = false) {
  const novoPedidoRef = push(pedidosRef);

  set(novoPedidoRef, {
    tipo,
    take,
    modo, // üëà salva fila / encomenda / senha
    status: 'preparo',
    criadoEm: Date.now()
  });
}

  //passo 3 - sincronizacao
  onValue(pedidosRef, (snapshot) => {
  preparo.innerHTML = '<h2>üë®‚Äçüç≥ EM PREPARO</h2>';
  pronto.innerHTML = '<h2>‚úÖ PRONTO</h2>';

  cont.carne = 0;
  cont.peixe = 0;
  cont.veg = 0;
  cont.opcao = 0;

  cont.take.carne = 0;
  cont.take.peixe = 0;
  cont.take.veg = 0;
  cont.take.opcao = 0;

  // üÜï limpa contadores de origem
  Object.keys(cont.origem).forEach(origem => {
    Object.keys(cont.origem[origem]).forEach(tipo => {
      cont.origem[origem][tipo] = 0;
    });
  });


  const dados = snapshot.val();
  if (!dados) {
    atualizar();
    return;
  }

  Object.entries(dados).forEach(([id, pedido]) => {
    cont[pedido.tipo]++;

    if (pedido.take) {
      cont.take[pedido.tipo]++;
    }

    if (pedido.modo && cont.origem[pedido.modo]) {
      cont.origem[pedido.modo][pedido.tipo]++;
    }

    renderPedido(id, pedido);
  });


  atualizar();
});
  
  // üîß Expor para uso global (importante)
  window.firebaseDB = {
    db,
    ref,
    set,
    push,
    onValue,
    remove,
    pedidosRef,
    criarPedido
  };

</script>
<script type="module">
  // üîé TESTE DE CONEX√ÉO COM FIREBASE (SEGURAN√áA)
  const { db, ref, set, onValue } = window.firebaseDB;

  const testeRef = ref(db, 'testeConexao');

  // Escreve algo no banco
  set(testeRef, {
    status: 'ok',
    timestamp: Date.now()
  });

  // L√™ de volta
  onValue(testeRef, (snapshot) => {
    console.log('üî• Firebase conectado:', snapshot.val());
  });
</script>


</body>
</html>
