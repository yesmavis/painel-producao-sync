<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#111111">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Painel de Produ√ß√£o">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" href="icon-192.png">
<title>Painel de Produ√ß√£o</title>

<style>
body {
  margin:0;
  font-family:Arial, sans-serif;
  background:#1b1b1b;
  color:white;
  height:100vh;
  display:flex;
  flex-direction:column;
}

header {
  background:#111;
  padding:10px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  position:relative;
}

#fecharCozinha {
  position:absolute;
  right:10px;
  top:10px;
  border:1px solid #555;
  background:transparent;
  color:#bbb;
  padding:6px 12px;
  border-radius:10px;
  cursor:pointer;
}

.modos {
  display:flex;
  gap:6px;
  padding:6px;
  background:#222;
}

.modos button {
  flex:1;
  height:40px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  opacity:.5;
}

.modos .ativo { opacity:1; }

.fila { background:#555; }
.encomenda { background:#ffca28; color:#000; }
.senha { background:#ab47bc; }

.contadores {
  display:flex;
  justify-content:space-around;
  background:#222;
  padding:6px;
  font-size:14px;
}

.botoes {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
  padding:8px;
}

button {
  height:50px;
  font-size:14px;
  font-weight:bold;
  border-radius:12px;
  border:none;
  color:white;
}

.carne { background:#e53935; }
.peixe { background:#1e88e5; }
.veg { background:#43a047; }
.opcao { background:#000; }

.take {
  border:2px dashed rgba(255,255,255,.6);
}

.painel {
  flex:1;
  display:flex;
  gap:6px;
  padding:6px;
}

.coluna {
  flex:1;
  background:#2a2a2a;
  border-radius:10px;
  padding:6px;
}

.coluna h2 {
  text-align:center;
  font-size:16px;
  margin:4px 0;
}

.pedido {
  height:38px;
  margin-bottom:4px;
  border-radius:8px;
  font-size:13px;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  background:var(--base-color);
}

/* Faixas ENCOMENDA e SENHA */
.pedido.encomenda {
  background:
    linear-gradient(to right, #ffca28 0%, #ffca28 33%, transparent 33%),
    var(--base-color);
}

.pedido.senha {
  background:
    linear-gradient(to right, #ab47bc 0%, #ab47bc 33%, transparent 33%),
    var(--base-color);
}

/* üõë Corre√ß√£o de contraste: OP√á√ïES + ENCOMENDA */
.pedido.encomenda.opcao {
  color: #fff;
}

.excluir {
  position:absolute;
  right:6px;
  top:6px;
  font-size:16px;
  cursor:pointer;
}

#resumo {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  align-items:center;
  justify-content:center;
}

#resumo .box {
  background:#222;
  padding:25px;
  border-radius:15px;
  width:320px;
  text-align:center;
}

/* =========================
   BOT√ïES DO RESUMO
========================= */

#resumo .box button {
  width: 100%;
  margin-top: 12px;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-size: 15px;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.1s ease;
}

/* Bot√£o PDF */
#resumo .btn-pdf {
  background: #1e88e5;
  color: #fff;
}

#resumo .btn-pdf:hover {
  background: #1565c0;
}

/* Bot√£o Encerrar */
#resumo .btn-encerrar {
  background: #e53935;
  color: #fff;
}

#resumo .btn-encerrar:hover {
  background: #c62828;
}

/* Clique */
#resumo .box button:active {
  transform: scale(0.97);
}

</style>
</head>

<body>

<header>
üçΩÔ∏è PAINEL DE PRODU√á√ÉO
<button id="fecharCozinha" onclick="fecharCozinha()">Fechar Cozinha</button>
</header>

<div class="modos">
<button class="fila ativo" onclick="setModo('fila',this)">üßç FILA</button>
<button class="encomenda" onclick="setModo('encomenda',this)">üì¶ ENCOMENDA</button>
<button class="senha" onclick="setModo('senha',this)">üé´ SENHA</button>
</div>

<div class="contadores">
üî¥ <span id="cCarne">0</span>
üü¶ <span id="cPeixe">0</span>
üü© <span id="cVeg">0</span>
‚ö´ <span id="cOpcao">0</span>
</div>

<div class="botoes">
<button class="carne" onclick="novoPedido('carne', false)">CARNE</button>
<button class="carne take" onclick="novoPedido('carne', true)">CARNE + TAKE</button>

<button class="peixe" onclick="novoPedido('peixe', false)">PEIXE</button>
<button class="peixe take" onclick="novoPedido('peixe', true)">PEIXE + TAKE</button>

<button class="veg" onclick="novoPedido('veg', false)">VEG</button>
<button class="veg take" onclick="novoPedido('veg', true)">VEG + TAKE</button>

<button class="opcao" onclick="novoPedido('opcao', false)">OP√á√ïES</button>
<button class="opcao take" onclick="novoPedido('opcao', true)">OP√á√ïES + TAKE</button>
</div>

<div class="painel">
  <div class="coluna" id="preparo"><h2>üë®‚Äçüç≥ EM PREPARO</h2></div>
  <div class="coluna" id="pronto"><h2>‚úÖ PRONTO</h2></div>
</div>

<div id="resumo">
  <div class="box">
    <h2>üìä Resumo do Turno</h2>
    <p>üî¥ Carne: <strong id="rCarne"></strong></p>
    <p>üü¶ Peixe: <strong id="rPeixe"></strong></p>
    <p>üü© Veg: <strong id="rVeg"></strong></p>
    <p>‚ö´ Op√ß√µes: <strong id="rOpcao"></strong></p>
    <p><strong>TOTAL: <span id="rTotal"></span></strong></p>
    <button class="btn-pdf" onclick="gerarPDFResumo()">üìÑ Baixar PDF</button>
    <button class="btn-encerrar" onclick="location.reload()">‚èπ Encerrar e reiniciar</button>
  </div>
</div>

<script>
/* ==========================
   CONFIGURA√á√ïES GERAIS
========================== */
const RESTAURANTE = 'Cafetaria Blend - Vila Real';
const VERSAO_APP = '1.0.0';
const LOCALE = 'en-US' // ou 'pt-BR'

/* ==========================
   ESTADO GLOBAL
========================== */
let modo='fila';
let numero=0;
const cont={carne:0,peixe:0,veg:0,opcao:0};
let ultimoResumoTurno = null;


function setModo(m,b){
  modo=m;
  document.querySelectorAll('.modos button').forEach(x=>x.classList.remove('ativo'));
  b.classList.add('ativo');
}

function atualizar(){
  cCarne.innerText=cont.carne;
  cPeixe.innerText=cont.peixe;
  cVeg.innerText=cont.veg;
  cOpcao.innerText=cont.opcao;
}

function novoPedido(tipo, take) {
  if (window.firebaseDB && window.firebaseDB.criarPedido) {
    window.firebaseDB.criarPedido(tipo, take);
  }
}

function renderPedido(id, pedido) {
  const { tipo, take, status } = pedido;

  // üö´ N√£o renderiza pedidos finalizados
  if (status === 'finalizado') return;

  const cores = {
    carne: '#e53935',
    peixe: '#1e88e5',
    veg: '#43a047',
    opcao: '#000'
  };

  const nomes = {
    carne: 'CARNE',
    peixe: 'PEIXE',
    veg: 'VEG',
    opcao: 'OP√á√ïES'
  };

  const p = document.createElement('div');
  p.className = `pedido ${pedido.modo}` + (take ? ' take' : '');
  p.style.setProperty('--base-color', cores[tipo]);
  p.dataset.id = id;
  p.innerText = nomes[tipo] + (take ? ' + TAKE' : '');

  const del = document.createElement('span');
  del.className = 'excluir';
  del.innerText = '‚ùå';

  function excluirPedido(e) {
    e.preventDefault();
    e.stopPropagation();

    const pedidoRef = window.firebaseDB.ref(
      window.firebaseDB.db,
      'pedidos/' + id
    );

    window.firebaseDB.remove(pedidoRef);
}

// Desktop / Android
  del.onclick = excluirPedido;

// iOS
  del.addEventListener('touchend', excluirPedido, { passive: false });

  p.appendChild(del);
  
  // üîÅ Fluxo: preparo ‚Üí pronto ‚Üí finalizado
  function avancarStatus(e) {
  e.preventDefault();
  e.stopPropagation();

  let novoStatus;

  if (pedido.status === 'preparo') {
    novoStatus = 'pronto';
  } else if (pedido.status === 'pronto') {
    novoStatus = 'finalizado';
  } else {
    return;
  }

  const pedidoRef = window.firebaseDB.ref(
    window.firebaseDB.db,
    'pedidos/' + id
  );

  window.firebaseDB.set(pedidoRef, {
    ...pedido,
    status: novoStatus
  });
}

// Desktop / Android
p.onclick = avancarStatus;

// iOS (fundamental)
p.addEventListener('touchend', avancarStatus, { passive: false });

  if (status === 'preparo') {
    preparo.appendChild(p);
  } else if (status === 'pronto') {
    pronto.appendChild(p);
  }
}
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>  
async function fecharCozinha() {
  // 1Ô∏è‚É£ Montar resumo
  ultimoResumoTurno = {
    carne: cont.carne,
    peixe: cont.peixe,
    veg: cont.veg,
    opcao: cont.opcao,
    total: cont.carne + cont.peixe + cont.veg + cont.opcao,
    encerradoEm: Date.now(),
    encerradoEmTexto: new Date().toLocaleString(LOCALE)
  };

  // 2Ô∏è‚É£ Mostrar resumo na tela
  rCarne.innerText = ultimoResumoTurno.carne;
  rPeixe.innerText = ultimoResumoTurno.peixe;
  rVeg.innerText = ultimoResumoTurno.veg;
  rOpcao.innerText = ultimoResumoTurno.opcao;
  rTotal.innerText = ultimoResumoTurno.total;
  resumo.style.display = 'flex';

  // 3Ô∏è‚É£ Salvar relat√≥rio no Firebase (hist√≥rico)
  const relatorioRef = window.firebaseDB.ref(
    window.firebaseDB.db,
    'relatorios'
  );

  await window.firebaseDB.push(relatorioRef, ultimoResumoTurno);

  // 4Ô∏è‚É£ Limpar pedidos ativos
  const pedidosRef = window.firebaseDB.ref(
    window.firebaseDB.db,
    'pedidos'
  );

  await window.firebaseDB.remove(pedidosRef);
}

function gerarPDFResumo() {
  if (!ultimoResumoTurno) {
    alert('Resumo ainda n√£o dispon√≠vel.');
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  let y = 20;

  // üè∑Ô∏è Restaurante
  doc.setFontSize(18);
  doc.setFont('helvetica', 'bold');
  doc.text(RESTAURANTE, 105, y, { align: 'center' });

  y += 10;

  // üìä T√≠tulo
  doc.setFontSize(14);
  doc.setFont('helvetica', 'normal');
  doc.text('Resumo do Turno', 105, y, { align: 'center' });

  y += 10;

  // üïí Data
  doc.setFontSize(11);
  doc.text(
    `Encerrado em: ${ultimoResumoTurno.encerradoEmTexto}`,
    105,
    y,
    { align: 'center' }
  );

  y += 15;

  // Linha
  doc.setDrawColor(200);
  doc.line(20, y, 190, y);

  y += 12;

  // Dados
  doc.setFontSize(12);
  doc.text(`Carne: ${ultimoResumoTurno.carne}`, 30, y); y += 8;
  doc.text(`Peixe: ${ultimoResumoTurno.peixe}`, 30, y); y += 8;
  doc.text(`Veg: ${ultimoResumoTurno.veg}`, 30, y); y += 8;
  doc.text(`Op√ß√µes: ${ultimoResumoTurno.opcao}`, 30, y); y += 12;

  doc.line(20, y, 190, y);
  y += 12;

  // Total
  doc.setFontSize(14);
  doc.setFont('helvetica', 'bold');
  doc.text(
    `TOTAL: ${ultimoResumoTurno.total}`,
    105,
    y,
    { align: 'center' }
  );

  doc.save(`resumo-turno-${Date.now()}.pdf`);
}


</script>

<script type="module">
  // Firebase core
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";

  // Realtime Database
  import {
    getDatabase,
    ref,
    set,
    push,
    onValue,
    remove
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCms7tcWbslK-d0WZ6g8lFr_eicNaz4Dp4",
    authDomain: "painel-producao-sync.firebaseapp.com",
    databaseURL: "https://painel-producao-sync-default-rtdb.firebaseio.com",
    projectId: "painel-producao-sync",
    storageBucket: "painel-producao-sync.firebasestorage.app",
    messagingSenderId: "563084163424",
    appId: "1:563084163424:web:274866215bb7b2faf7c605"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // passo 1 - referencia principal dos pedidos
  const pedidosRef = ref(db, 'pedidos');

  //passo 2 - funcao para criar pedido
  function criarPedido(tipo, take = false) {
  const novoPedidoRef = push(pedidosRef);

  set(novoPedidoRef, {
    tipo,
    take,
    modo, // üëà salva fila / encomenda / senha
    status: 'preparo',
    criadoEm: Date.now()
  });
}

  //passo 3 - sincronizacao
  onValue(pedidosRef, (snapshot) => {
  preparo.innerHTML = '<h2>üë®‚Äçüç≥ EM PREPARO</h2>';
  pronto.innerHTML = '<h2>‚úÖ PRONTO</h2>';

  cont.carne = 0;
  cont.peixe = 0;
  cont.veg = 0;
  cont.opcao = 0;

  const dados = snapshot.val();
  if (!dados) {
    atualizar();
    return;
  }

  Object.entries(dados).forEach(([id, pedido]) => {
    cont[pedido.tipo]++;
    renderPedido(id, pedido);
  });

  atualizar();
});
  
  // üîß Expor para uso global (importante)
  window.firebaseDB = {
    db,
    ref,
    set,
    push,
    onValue,
    remove,
    pedidosRef,
    criarPedido
  };

</script>
<script type="module">
  // üîé TESTE DE CONEX√ÉO COM FIREBASE (SEGURAN√áA)
  const { db, ref, set, onValue } = window.firebaseDB;

  const testeRef = ref(db, 'testeConexao');

  // Escreve algo no banco
  set(testeRef, {
    status: 'ok',
    timestamp: Date.now()
  });

  // L√™ de volta
  onValue(testeRef, (snapshot) => {
    console.log('üî• Firebase conectado:', snapshot.val());
  });
</script>


</body>
</html>

